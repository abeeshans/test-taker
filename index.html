<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Test Taker</title>
    <!-- External libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web" defer></script>
    <!-- Optional vendorized lottie: drop a local lottie.min.js at assets/lottie.min.js to use local copy -->
    <script src="assets/lottie.min.js" defer></script>
    <link rel="stylesheet" href="style.css">
</head>

<body class="h-full font-sans antialiased">

    <div id="app" class="h-full">
        <!-- === SCREEN 2: TEST DASHBOARD === -->
        <div id="dashboard-screen" class="hidden h-full">
            <header class="bg-white shadow-md p-4 flex items-center space-x-6">
                <h1 class="text-2xl font-bold text-gray-800 flex-shrink-0">Dashboard</h1>
                <div class="relative flex-grow">
                    <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="search" id="search-bar" placeholder="Search tests..."
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex items-center space-x-4 flex-shrink-0">
                    <button id="create-folder-btn"
                        class="text-sm bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-md flex items-center">
                        <i class="ph ph-folder-plus text-lg mr-1"></i>
                        Create Folder
                    </button>
                    <button id="add-files-btn"
                        class="text-sm bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md flex items-center">
                        <i class="ph ph-plus-circle text-lg mr-1"></i>
                        Add More Files
                    </button>
                    <input type="file" id="add-files-input" class="hidden" multiple accept=".json">

                    <button id="change-folder-btn"
                        class="text-sm text-gray-600 hover:text-blue-800 font-medium flex items-center">
                        <i class="ph ph-folder-open text-lg mr-1"></i>
                        Load from Folder
                    </button>
                    <button id="dashboard-help-btn"
                        class="text-sm text-gray-600 hover:text-blue-800 font-medium flex items-center p-2 rounded-full bg-gray-100 hover:bg-gray-200"
                        title="Help">
                        <i class="ph ph-question text-xl"></i>
                    </button>
                </div>
            </header>
            <main class="p-8 h-full overflow-y-auto bg-gray-100">
                <div id="test-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Test cards will be injected here -->
                    <!-- A 'How to Use' card will be injected here by renderDashboard -->
                </div>
            </main>
        </div>

        <!-- === SCREEN 3: TEST TAKER === -->
        <div id="test-screen" class="hidden h-full">
            <!-- Header Bar -->
            <header class="bg-white shadow-md flex items-center justify-between p-4 h-16">
                <div class="flex items-center">
                    <h1 id="test-title-header" class="text-xl font-bold text-gray-800">Test In Progress...</h1>
                </div>
                <div class="flex-1 mx-8">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="flex items-center text-gray-700">
                        <i class="ph ph-timer text-xl align-middle mr-1"></i>
                        <span id="timer" class="font-medium text-lg">00:00:00</span>
                    </div>
                    <div id="away-clicks-counter-container" class="flex items-center text-red-600"
                        title="Away clicks counter">
                        <i class="ph ph-warning-circle text-xl align-middle mr-1"></i>
                        <span id="away-clicks-counter" class="font-medium text-lg">0</span>
                    </div>
                    <div class="flex items-center text-gray-700">
                        <button id="help-btn" class="text-gray-700 hover:text-blue-600" title="Text interface guide">
                            <i class="ph ph-question text-xl align-middle mr-1"></i>
                        </button>
                        <span id="question-counter" class="font-medium text-lg">1 / 10</span>
                    </div>
                    <button id="review-dashboard-btn"
                        class="hidden bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md flex items-center">
                        <i class="ph ph-squares-four text-lg mr-1"></i> Dashboard
                    </button>
                    <button id="finish-btn-header"
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md flex items-center">
                        <i class="ph ph-check-circle text-lg mr-1"></i> Finish
                    </button><button id="pause-btn"
                        class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-md flex items-center">
                        <i class="ph ph-pause text-lg mr-1"></i>
                        <span id="pause-btn-text">Pause</span>
                    </button>
                </div>
            </header>

            <!-- Main Test Layout (2-col) -->
            <div class="main-layout flex w-full" style="height: calc(100vh - 8rem);">
                <!-- Left: Passage -->
                <div id="passage-container" class="w-1/2 p-6 overflow-y-auto border-r border-gray-300 bg-white">
                    <!-- Passage content injected here -->
                </div>

                <!-- Right: Question -->
                <div id="question-container" class="w-1/2 p-6 overflow-y-auto bg-gray-50 flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="question-number" class="text-xl font-semibold text-gray-800">Question 1</h2>
                        <button id="flag-btn"
                            class="border border-gray-300 hover:bg-gray-100 text-gray-700 font-medium py-2 px-4 rounded-md flex items-center">
                            <i class="ph ph-flag text-lg mr-1"></i>
                            <span>Flag for Review</span>
                        </button>
                    </div>
                    <p id="question-text" class="text-gray-700 text-lg mb-6 leading-relaxed">Question text...</p>
                    <div id="options-container" class="space-y-4">
                        <!-- Options injected here -->
                    </div>
                </div>
            </div>

            <!-- Footer Bar -->
            <footer class="bg-white shadow-inner flex justify-between items-center p-4 h-16 border-t border-gray-200">
                <button id="prev-btn"
                    class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-md flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="ph ph-arrow-left text-lg mr-1"></i>
                    Previous
                </button>
                <button id="nav-btn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-md flex items-center">
                    <i class="ph ph-navigation-arrow text-lg mr-1"></i>
                    Navigation
                </button>
                <button id="next-btn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-md flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                    Next
                    <i class="ph ph-arrow-right text-lg ml-1"></i>
                </button>
            </footer>
        </div>

        <!-- === SCREEN 4: RESULTS SCREEN === -->
        <div id="results-screen" class="hidden flex items-center justify-center h-full">
            <div class="bg-white p-8 rounded-lg shadow-lg text-center max-w-2xl w-full">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">Test Complete!</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-8 text-lg">
                    <div class="bg-blue-100 p-4 rounded-lg">
                        <div class="text-sm font-semibold text-blue-800">SCORE</div>
                        <div id="results-score" class="text-3xl font-bold text-blue-900">10 / 12</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <div class="text-sm font-semibold text-green-800">PERCENTAGE</div>
                        <div id="results-percentage" class="text-3xl font-bold text-green-900">83%</div>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg">
                        <div class="text-sm font-semibold text-red-800">AWAY CLICKS</div>
                        <div id="results-away-clicks" class="text-3xl font-bold text-red-900">2</div>
                    </div>
                </div>
                <div class="flex justify-center space-x-4">
                    <button id="review-btn"
                        class="w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                        <i class="ph ph-eye text-xl mr-2"></i>
                        Review Test
                    </button>
                    <button id="dashboard-btn"
                        class="w-full inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        <i class="ph ph-squares-four text-xl mr-2"></i>
                        Back to Dashboard
                    </button>
                </div>
            </div>
        </div>

        <!-- === MODALS / OVERLAYS === -->

        <!-- Navigation Modal -->
        <div id="nav-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col">
                <div class="flex justify-between items-center p-4 border-b">
                    <h2 class="text-xl font-semibold text-gray-800">Question Navigation</h2>
                    <button id="close-nav-modal-btn" class="text-gray-500 hover:text-gray-700">
                        <i class="ph ph-x text-2xl"></i>
                    </button>
                </div>
                <div id="nav-grid" class="p-6 overflow-y-auto grid grid-cols-10 gap-2">
                    <!-- Nav items injected here -->
                </div>
                <div id="nav-legend-test" class="p-4 bg-gray-50 border-t flex justify-start space-x-4">
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-blue-600 mr-2"></div>
                        <span class="text-sm text-gray-700">Current</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-green-500 mr-2"></div>
                        <span class="text-sm text-gray-700">Answered</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-gray-300 mr-2"></div>
                        <span class="text-sm text-gray-700">Unanswered</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-yellow-300 mr-2"></div>
                        <span class="text-sm text-gray-700">Flagged</span>
                    </div>
                </div>
                <div id="nav-legend-review" class="hidden p-4 bg-gray-50 border-t grid grid-cols-2 gap-x-4 gap-y-2">
                    <div class="flex items-center"><i class="ph-fill ph-check-circle text-green-600 mr-2"></i><span
                            class="text-sm">Correct</span></div>
                    <div class="flex items-center"><i class="ph-fill ph-x-circle text-red-600 mr-2"></i><span
                            class="text-sm">Incorrect</span></div>
                    <div class="flex items-center"><i class="ph-fill ph-minus-circle text-yellow-600 mr-2"></i><span
                            class="text-sm">Unanswered</span></div>
                    <div class="flex items-center"><i class="ph-fill ph-flag text-blue-600 mr-2"></i><span
                            class="text-sm">Ever Flagged</span></div>
                </div>
            </div>
        </div>

        <!-- Pause Overlay -->
        <div id="pause-overlay"
            class="hidden fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-40 flex-col">
            <h1 class="text-6xl font-bold text-white mb-8">Test Paused</h1>
            <button id="resume-overlay-btn"
                class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-md flex items-center text-2xl">
                <i class="ph ph-play text-3xl mr-2"></i>
                Resume Test
            </button>
            <button id="abandon-test-btn"
                class="mt-6 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-md flex items-center text-lg">
                <i class="ph ph-trash text-xl mr-2"></i>
                Abandon Test
            </button>
        </div>

        <!-- Time Input Modal -->
        <div id="time-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Set Test Time</h2>
                <p class="text-gray-600 mb-4">How many minutes for this test?</p>
                <input type="number" id="time-input-modal" class="w-full border border-gray-300 p-2 rounded-md mb-4"
                    placeholder="e.g., 180">
                <div class="flex justify-end space-x-2">
                    <button id="cancel-time-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="start-test-confirm-btn"
                        class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Start</button>
                </div>
            </div>
        </div>

        <!-- Create Folder Modal -->
        <div id="create-folder-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Create Folder</h2>
                <p class="text-gray-600 mb-4">Enter a name for the new folder.</p>
                <input id="create-folder-input" type="text" class="w-full border border-gray-300 p-2 rounded-md mb-4"
                    placeholder="Folder name">
                <div class="flex justify-end space-x-2">
                    <button id="cancel-create-folder-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="confirm-create-folder-btn"
                        class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Create</button>
                </div>
            </div>
        </div>

        <!-- Rename Modal -->
        <div id="rename-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Rename Test</h2>
                <p class="text-gray-600 mb-4">Enter a new name for the test.</p>
                <input id="rename-input" type="text" class="w-full border border-gray-300 p-2 rounded-md mb-4"
                    placeholder="New test name">
                <div class="flex justify-end space-x-2">
                    <button id="rename-cancel-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="rename-confirm-btn"
                        class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Rename</button>
                </div>
            </div>
        </div>

        <!-- Reset Stats Modal -->
        <div id="reset-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Reset Stats</h2>
                <p id="reset-modal-message" class="text-gray-700 mb-6">Are you sure you want to reset stats for this
                    test? This cannot be undone.</p>
                <div class="flex justify-end space-x-2">
                    <button id="reset-cancel-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="reset-confirm-btn"
                        class="px-4 py-2 rounded-md bg-yellow-500 text-white hover:bg-yellow-600">Reset</button>
                </div>
            </div>
        </div>

        <!-- Delete Test Modal -->
        <div id="delete-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Delete Test</h2>
                <p id="delete-modal-message" class="text-gray-700 mb-6">Are you sure you want to permanently delete this
                    test? This cannot be undone.</p>
                <div class="flex justify-end space-x-2">
                    <button id="delete-cancel-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="delete-confirm-btn"
                        class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700">Delete</button>
                </div>
            </div>
        </div>

        <!-- Custom Alert Modal -->
        <div id="alert-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 id="alert-title" class="text-xl font-semibold mb-2">Alert</h2>
                <div id="alert-message" class="text-gray-600 mb-6 text-sm">This is an alert message.</div>
                <button id="alert-ok-btn"
                    class="px-6 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">OK</button>
            </div>
        </div>

        <!-- Dashboard Help Modal -->
        <div id="dashboard-help-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center p-4 border-b">
                    <h2 class="text-xl font-semibold text-gray-800">Help & Information</h2>
                    <button id="close-dashboard-help-btn" class="text-gray-500 hover:text-gray-700">
                        <i class="ph ph-x text-2xl"></i>
                    </button>
                </div>
                <!-- Dynamic load summary (populated by renderer.js) -->
                <div id="load-summary" class="p-4 bg-yellow-50 border-b text-sm text-gray-700 hidden"></div>
                <div class="p-6 overflow-y-auto space-y-3 text-sm">
                    <details class="bg-gray-50 p-3 rounded-lg" open>
                        <summary class="font-semibold cursor-pointer text-base">About This App</summary>
                        <div class="mt-3 text-gray-700 prose prose-sm max-w-none">
                            <p>This is a custom test-taking application designed to help you practice with your own
                                question sets in <code>.json</code> format. It saves your progress and stats locally in
                                your browser.</p>
                        </div>
                    </details>
                    <details class="bg-gray-50 p-3 rounded-lg">
                        <summary class="font-semibold cursor-pointer text-base">Adding Tests</summary>
                        <div class="mt-3 text-gray-700 prose prose-sm max-w-none">
                            <p>You can add tests in two ways:</p>
                            <ul>
                                <li><strong>Auto-Loading:</strong> On startup, the app looks for a
                                    <code>/json/manifest.json</code> file to load tests automatically. This works best
                                    when running from a local web server.
                                </li>
                                <li><strong>Manual Loading:</strong> Use the <strong>"Add More Files"</strong> or
                                    <strong>"Load from Folder"</strong> buttons in the header.
                                </li>
                            </ul>
                            <p>Your <code>.json</code> files must be an array of question objects. Here is a basic
                                example:</p>
                            <pre class="bg-gray-200 p-2 rounded text-xs whitespace-pre-wrap"><code>[
  {
    "passage": "Optional passage text...",
    "question": "What is the capital of France?",
    "options": [
      "A. London", "B. Paris", "C. Berlin"
    ],
    "correctAnswer": "B. Paris"
  }
]</code></pre>
                        </div>
                    </details>
                    <details class="bg-gray-50 p-3 rounded-lg">
                        <summary class="font-semibold cursor-pointer text-base">Starting a Test</summary>
                        <div class="mt-3 text-gray-700 prose prose-sm max-w-none">
                            <p>Click the <strong>"Start Test"</strong> button on any card. You will be prompted to enter
                                a time limit in minutes. During the test, you can use keyboard shortcuts (like arrow
                                keys, 1-4 for answers, F for flag, P for pause) for faster navigation.</p>
                        </div>
                    </details>
                    <details class="bg-gray-50 p-3 rounded-lg">
                        <summary class="font-semibold cursor-pointer text-base">Dashboard Features</summary>
                        <div class="mt-3 text-gray-700 prose prose-sm max-w-none">
                            <ul>
                                <li><i class="ph ph-folder-plus"></i> <strong>Create Folder:</strong> Use the button in
                                    the header to create folders for organization.</li>
                                <li><i class="ph ph-hand-grabbing"></i> <strong>Drag & Drop:</strong> Drag test cards
                                    and drop them into folders to group them.</li>
                                <li><i class="ph-fill ph-star text-yellow-400"></i> <strong>Star:</strong> Click the
                                    star icon to pin a test to the top of the list.</li>
                                <li><i class="ph ph-chart-bar"></i> <strong>Stats:</strong> The cards display your
                                    number of attempts, average score, and last score for each test.</li>
                                <li><i class="ph ph-magnifying-glass"></i> <strong>Search:</strong> Use the search bar
                                    to quickly filter tests by name.</li>
                                <li><i class="ph ph-dots-three-vertical"></i> <strong>Card Menu:</strong> Click the
                                    kebab menu on a card to access more options:
                                    <ul class="my-1">
                                        <li><i class="ph ph-pencil-simple"></i> <strong>Rename:</strong> Give a test a
                                            more descriptive name.</li>
                                        <li><i class="ph ph-arrow-counter-clockwise"></i> <strong>Reset stats:</strong>
                                            Clear all statistics for a specific test.</li>
                                        <li><i class="ph ph-trash"></i> <strong>Delete:</strong> Permanently remove a
                                            test and its stats.</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- Generic Confirm Modal -->
        <div id="confirm-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 id="confirm-modal-title" class="text-lg font-semibold mb-2">Please Confirm</h2>
                <p id="confirm-modal-message" class="text-gray-700 mb-6">Are you sure?</p>
                <div class="flex justify-end space-x-2">
                    <button id="confirm-modal-cancel"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="confirm-modal-confirm"
                        class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Application script -->
    <script src="renderer.js" defer></script>


</body>

</html>