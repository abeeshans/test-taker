<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Test Taker</title>
    <!-- External libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web" defer></script>
    <!-- Optional vendorized lottie support removed -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="h-full font-sans antialiased">

    <div id="app" class="h-full">
        <!-- === SCREEN 2: TEST DASHBOARD === -->
        <div id="dashboard-screen" class="hidden h-full">
            <header class="bg-white shadow-md p-4 flex items-center space-x-6">
                <div class="flex items-center gap-3">
                    <!-- Custom app logo (PracticeTests.svg) -->
                    <svg id="app-logo" width="36" height="36" viewBox="0 0 612 612" xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="false" role="img" class="flex-shrink-0">
                        <defs>
                            <linearGradient id="linear-gradient" x1="349.4" y1="254.9" x2="511.6" y2="254.9"
                                gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#054a75" />
                                <stop offset="1" stop-color="#026965" />
                            </linearGradient>
                            <linearGradient id="linear-gradient1" x1="245.5" y1="505.6" x2="221.7" y2="264.1"
                                gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#0358a4" />
                                <stop offset="1" stop-color="#4392cf" />
                            </linearGradient>
                            <linearGradient id="linear-gradient2" x1="302.4" y1="227.4" x2="384.6" y2="194.2"
                                gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#08a7dd" />
                                <stop offset="1" stop-color="#00afc7" />
                            </linearGradient>
                            <linearGradient id="linear-gradient3" x1="102.1" y1="148.1" x2="511.6" y2="148.1"
                                gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#3e86c6" />
                                <stop offset="1" stop-color="#01b092" />
                            </linearGradient>
                        </defs>
                        <path fill="url(#linear-gradient)"
                            d="M511.6,148.8v107.7c0,5.8-3.1,11.1-8,14l-154.1,90.5v-64.2l111.7-61.8v-60.1l50.5-26.1Z" />
                        <path fill="#19305b"
                            d="M349.4,238.2v193.5c0,.8-.3,1.6-.7,2.2l-51.1,70-29-42.5c8-13.2,26-38.9,26-38.9l.6-220.9,54.2,36.7Z" />
                        <path fill="url(#linear-gradient1)"
                            d="M297.5,503.9l-22.3,30.5c-3.4,4.7-10.5,4.7-13.9,0l-75.2-101.6v-176.8s55-27.7,55-27.7v193.5s23.8,33.3,27.5,39.5l29,42.5Z" />
                        <path fill="url(#linear-gradient2)"
                            d="M408.1,206.9l-58.7,31.4-54.2-36.7,41.6-18c8-3.4,17-3.2,24.8.6l46.4,22.7Z" />
                        <path fill="url(#linear-gradient3)"
                            d="M511.6,148.8l-50.5,26.1-120.3-59.2-238.8,120.7v-36.4c0-11.1,6.2-21.3,16.1-26.4l222.4-113.9,171,89Z" />
                    </svg>
                    <button id="dashboard-title-btn"
                        class="text-2xl font-bold text-gray-800 flex-shrink-0 text-left bg-transparent border-0 p-0">Dashboard</button>
                </div>
                <div class="relative flex-grow">
                    <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="search" id="search-bar" placeholder="Search tests..."
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex items-center space-x-4 flex-shrink-0">
                    <button id="create-folder-btn"
                        class="text-sm bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-md flex items-center">
                        <i class="ph ph-folder-plus text-lg mr-1"></i>
                        Create Folder
                    </button>
                    <button id="add-files-btn"
                        class="text-sm bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md flex items-center btn-primary">
                        <i class="ph ph-plus-circle text-lg mr-1"></i>
                        Add More Files
                    </button>
                    <input type="file" id="add-files-input" class="hidden" multiple accept=".json">

                    <button id="test-stats-btn"
                        class="text-sm font-medium flex items-center p-2 rounded-md bg-yellow-600 hover:bg-yellow-700 text-white"
                        title="Test Statistics">
                        <i class="ph ph-chart-bar text-lg mr-1"></i>
                        <span>Test Statistics</span>
                    </button>
                    <button id="dashboard-help-btn"
                        class="text-sm text-gray-600 hover:text-blue-800 font-medium flex items-center p-2 rounded-full bg-gray-100 hover:bg-gray-200"
                        title="Help">
                        <i class="ph ph-question text-xl"></i>
                    </button>
                </div>
            </header>
            <main class="p-8 h-full overflow-y-auto bg-gray-100">
                <div id="test-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Test cards will be injected here -->
                    <!-- A 'How to Use' card will be injected here by renderDashboard -->
                </div>
            </main>
        </div>

        <!-- === SCREEN 3: TEST TAKER === -->
        <div id="test-screen" class="hidden h-full">
            <!-- Header Bar -->
            <header class="bg-white shadow-md flex items-center justify-between p-4 h-16">
                <div class="flex items-center">
                    <h1 id="test-title-header" class="text-xl font-bold text-gray-800">Test In Progress...</h1>
                </div>
                <div class="flex-1 mx-8">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="flex items-center text-gray-700">
                        <i class="ph ph-timer text-xl align-middle mr-1"></i>
                        <span id="timer" class="font-medium text-lg">00:00:00</span>
                    </div>
                    <div id="away-clicks-counter-container" class="flex items-center text-red-600"
                        title="Away clicks counter">
                        <i class="ph ph-warning-circle text-xl align-middle mr-1"></i>
                        <span id="away-clicks-counter" class="font-medium text-lg">0</span>
                    </div>
                    <div class="flex items-center text-gray-700">
                        <button id="help-btn" class="text-gray-700 hover:text-blue-600" title="Text interface guide">
                            <i class="ph ph-question text-xl align-middle mr-1"></i>
                        </button>
                        <span id="question-counter" class="font-medium text-lg">1 / 10</span>
                    </div>
                    <button id="review-dashboard-btn"
                        class="hidden bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md flex items-center">
                        <i class="ph ph-squares-four text-lg mr-1"></i> Dashboard
                    </button>
                    <button id="finish-btn-header"
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md flex items-center btn-success">
                        <i class="ph ph-check-circle text-lg mr-1"></i> Finish
                    </button>
                    <button id="pause-btn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md flex items-center btn-primary">
                        <i class="ph ph-pause text-lg mr-1"></i>
                        <span id="pause-btn-text">Pause</span>
                    </button>
                </div>
            </header>

            <!-- Main Test Layout (2-col) -->
            <div class="main-layout flex w-full" style="height: calc(100vh - 8rem);">
                <!-- Left: Passage -->
                <div id="passage-container" class="w-1/2 p-6 overflow-y-auto border-r border-gray-300 bg-white">
                    <!-- Passage content injected here -->
                </div>

                <!-- Right: Question -->
                <div id="question-container" class="w-1/2 p-6 overflow-y-auto bg-gray-50 flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="question-number" class="text-xl font-semibold text-gray-800">Question 1</h2>
                        <button id="flag-btn"
                            class="border border-gray-300 hover:bg-gray-100 text-gray-700 font-medium py-2 px-4 rounded-md flex items-center">
                            <i class="ph ph-flag text-lg mr-1"></i>
                            <span>Flag for Review</span>
                        </button>
                    </div>
                    <p id="question-text" class="text-gray-700 text-lg mb-6 leading-relaxed">Question text...</p>
                    <div id="options-container" class="space-y-4">
                        <!-- Options injected here -->
                    </div>
                </div>
            </div>

            <!-- Footer Bar -->
            <footer class="bg-white shadow-inner flex justify-between items-center p-4 h-16 border-t border-gray-200">
                <button id="prev-btn"
                    class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-md flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="ph ph-arrow-left text-lg mr-1"></i>
                    Previous
                </button>
                <button id="nav-btn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-md flex items-center btn-primary">
                    <i class="ph ph-navigation-arrow text-lg mr-1"></i>
                    Navigation
                </button>
                <button id="next-btn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-md flex items-center disabled:opacity-50 disabled:cursor-not-allowed btn-primary">
                    Next
                    <i class="ph ph-arrow-right text-lg ml-1"></i>
                </button>
            </footer>
        </div>

        <!-- === SCREEN 4: RESULTS SCREEN === -->
        <div id="results-screen" class="hidden flex items-center justify-center h-full">
            <div class="bg-white p-8 rounded-lg shadow-lg text-center max-w-2xl w-full">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">Test Complete!</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-8 text-lg">
                    <div class="bg-blue-100 p-4 rounded-lg">
                        <div class="text-sm font-semibold text-blue-800">SCORE</div>
                        <div id="results-score" class="text-3xl font-bold text-blue-900">10 / 12</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <div class="text-sm font-semibold text-green-800">PERCENTAGE</div>
                        <div id="results-percentage" class="text-3xl font-bold text-green-900">83%</div>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg">
                        <div class="text-sm font-semibold text-red-800">AWAY CLICKS</div>
                        <div id="results-away-clicks" class="text-3xl font-bold text-red-900">2</div>
                    </div>
                </div>
                <div class="flex justify-center space-x-4">
                    <button id="review-btn"
                        class="w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 btn-primary">
                        <i class="ph ph-eye text-xl mr-2"></i>
                        Review Test
                    </button>
                    <button id="dashboard-btn"
                        class="w-full inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        <i class="ph ph-squares-four text-xl mr-2"></i>
                        Back to Dashboard
                    </button>
                </div>
            </div>
        </div>

        <!-- === MODALS / OVERLAYS === -->

        <!-- Navigation Modal -->
        <div id="nav-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col">
                <div class="flex justify-between items-center p-4 border-b">
                    <h2 class="text-xl font-semibold text-gray-800">Question Navigation</h2>
                    <button id="close-nav-modal-btn" class="text-gray-500 hover:text-gray-700">
                        <i class="ph ph-x text-2xl"></i>
                    </button>
                </div>
                <div id="nav-grid" class="p-6 overflow-y-auto grid grid-cols-10 gap-2">
                    <!-- Nav items injected here -->
                </div>
                <div id="nav-legend-test" class="p-4 bg-gray-50 border-t flex justify-start space-x-4">
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-blue-600 mr-2"></div>
                        <span class="text-sm text-gray-700">Current</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-green-500 mr-2"></div>
                        <span class="text-sm text-gray-700">Answered</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-gray-300 mr-2"></div>
                        <span class="text-sm text-gray-700">Unanswered</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full bg-yellow-300 mr-2"></div>
                        <span class="text-sm text-gray-700">Flagged</span>
                    </div>
                </div>
                <div id="nav-legend-review" class="hidden p-4 bg-gray-50 border-t grid grid-cols-2 gap-x-4 gap-y-2">
                    <div class="flex items-center"><i class="ph-fill ph-check-circle text-green-600 mr-2"></i><span
                            class="text-sm">Correct</span></div>
                    <div class="flex items-center"><i class="ph-fill ph-x-circle text-red-600 mr-2"></i><span
                            class="text-sm">Incorrect</span></div>
                    <div class="flex items-center"><i class="ph-fill ph-minus-circle text-yellow-600 mr-2"></i><span
                            class="text-sm">Unanswered</span></div>
                    <div class="flex items-center"><i class="ph-fill ph-flag text-blue-600 mr-2"></i><span
                            class="text-sm">Ever Flagged</span></div>
                </div>
            </div>
        </div>

        <!-- Pause Overlay -->
        <div id="pause-overlay"
            class="hidden fixed inset-0 bg-gray-900 bg-opacity-40 flex items-center justify-center z-40 p-6">
            <div class="pause-panel">
                <h1 class="text-4xl font-bold mb-2">Test Paused</h1>
                <div class="pause-actions">
                    <button id="resume-overlay-btn"
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-md flex items-center text-2xl btn-success">
                        <i class="ph ph-play text-3xl mr-2"></i>
                        Resume Test
                    </button>
                    <button id="abandon-test-btn"
                        class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-md flex items-center text-lg btn-danger">
                        <i class="ph ph-trash text-xl mr-2"></i>
                        Abandon Test
                    </button>
                </div>
            </div>
        </div>

        <!-- Time Input Modal -->
        <div id="time-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Set Test Time</h2>
                <p class="text-gray-600 mb-4">How many minutes for this test?</p>
                <input type="number" id="time-input-modal" class="w-full border border-gray-300 p-2 rounded-md mb-4"
                    placeholder="e.g., 180">
                <!-- Set picker (appears when the loaded test file contains multiple sets) -->
                <div id="time-modal-set-select-wrapper" class="hidden text-left mb-3">
                    <label for="time-modal-set-select" class="text-sm font-medium text-gray-700 block mb-1">Choose
                        set</label>
                    <select id="time-modal-set-select" class="w-full border border-gray-300 p-2 rounded-md">
                        <!-- Options populated dynamically -->
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button id="cancel-time-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="start-test-confirm-btn"
                        class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 btn-primary">Start</button>
                </div>
            </div>
        </div>

        <!-- Create Folder Modal -->
        <div id="create-folder-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Create Folder</h2>
                <p class="text-gray-600 mb-4">Enter a name for the new folder.</p>
                <input id="create-folder-input" type="text" class="w-full border border-gray-300 p-2 rounded-md mb-4"
                    placeholder="Folder name">
                <div class="flex justify-end space-x-2">
                    <button id="cancel-create-folder-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="confirm-create-folder-btn"
                        class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 btn-primary">Create</button>
                </div>
            </div>
        </div>

        <!-- Rename Modal -->
        <div id="rename-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Rename Test</h2>
                <p class="text-gray-600 mb-4">Enter a new name for the test.</p>
                <input id="rename-input" type="text" class="w-full border border-gray-300 p-2 rounded-md mb-4"
                    placeholder="New test name">
                <div class="flex justify-end space-x-2">
                    <button id="rename-cancel-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="rename-confirm-btn"
                        class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 btn-primary">Rename</button>
                </div>
            </div>
        </div>

        <!-- Reset Stats Modal -->
        <div id="reset-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Reset Stats</h2>
                <p id="reset-modal-message" class="text-gray-700 mb-6">Are you sure you want to reset stats for this
                    test? This cannot be undone.</p>
                <div class="flex justify-end space-x-2">
                    <button id="reset-cancel-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="reset-confirm-btn"
                        class="px-4 py-2 rounded-md bg-yellow-500 text-white hover:bg-yellow-600 btn-warning">Reset</button>
                </div>
            </div>
        </div>

        <!-- Delete Test Modal -->
        <div id="delete-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4">Delete Test</h2>
                <p id="delete-modal-message" class="text-gray-700 mb-6">Are you sure you want to permanently delete this
                    test? This cannot be undone.</p>
                <div class="flex justify-end space-x-2">
                    <button id="delete-cancel-btn"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="delete-confirm-btn"
                        class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 btn-danger">Delete</button>
                </div>
            </div>
        </div>

        <!-- Custom Alert Modal -->
        <div id="alert-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 id="alert-title" class="text-xl font-semibold mb-2">Alert</h2>
                <div id="alert-message" class="text-gray-600 mb-6 text-sm">This is an alert message.</div>
                <button id="alert-ok-btn"
                    class="px-6 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 btn-primary">OK</button>
            </div>
        </div>

        <!-- Dashboard Help Modal -->
        <div id="dashboard-help-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center p-4 border-b">
                    <h2 class="text-xl font-semibold text-gray-800">Help & Information</h2>
                    <button id="close-dashboard-help-btn" class="text-gray-500 hover:text-gray-700">
                        <i class="ph ph-x text-2xl"></i>
                    </button>
                </div>
                <!-- Dynamic load summary (populated by renderer.js) -->
                <div id="load-summary" class="p-4 bg-yellow-50 border-b text-sm text-gray-700 hidden"></div>
                <div class="p-6 overflow-y-auto space-y-3 text-sm">
                    <details class="bg-gray-50 p-3 rounded-lg" open>
                        <summary class="font-semibold cursor-pointer text-base">About This App</summary>
                        <div class="mt-3 text-gray-700 prose prose-sm max-w-none">
                            <p>This is a custom test-taking application designed to help you practice with your own
                                question sets in <code>.json</code> format. It saves your progress and stats locally in
                                your browser.</p>
                        </div>
                    </details>
                    <details class="bg-gray-50 p-3 rounded-lg">
                        <summary class="font-semibold cursor-pointer text-base">Adding Tests</summary>
                        <div class="mt-3 text-gray-700 prose prose-sm max-w-none">
                            <p>You can add tests in two ways:</p>
                            <ul>
                                <li><strong>Auto-Loading:</strong> On startup, the app looks for a
                                    <code>/json/manifest.json</code> file to load tests automatically. This works best
                                    when running from a local web server.
                                </li>
                                <li><strong>Manual Loading:</strong> Use the <strong>"Add More Files"</strong> or
                                    <strong>"Load from Folder"</strong> buttons in the header.
                                </li>
                            </ul>
                            <p>Your <code>.json</code> files must be an array of question objects. Here is a basic
                                example:</p>
                            <pre class="bg-gray-200 p-2 rounded text-xs whitespace-pre-wrap"><code>[
  {
    "passage": "Optional passage text...",
    "question": "What is the capital of France?",
    "options": [
      "A. London", "B. Paris", "C. Berlin"
    ],
    "correctAnswer": "B. Paris"
  }
]</code></pre>
                        </div>
                    </details>
                    <details class="bg-gray-50 p-3 rounded-lg">
                        <summary class="font-semibold cursor-pointer text-base">Starting a Test</summary>
                        <div class="mt-3 text-gray-700 prose prose-sm max-w-none">
                            <p>Click the <strong>"Start Test"</strong> button on any card. You will be prompted to enter
                                a time limit in minutes. During the test, you can use keyboard shortcuts (like arrow
                                keys, 1-4 for answers, F for flag, P for pause) for faster navigation.</p>
                        </div>
                    </details>
                    <details class="bg-gray-50 p-3 rounded-lg">
                        <summary class="font-semibold cursor-pointer text-base">Dashboard Features</summary>
                        <div class="mt-3 text-gray-700 prose prose-sm max-w-none">
                            <p>This section explains the core dashboard features and quick workflows so you can get
                                productive fast.</p>

                            <h4 class="mt-2">Organization</h4>
                            <ul>
                                <li><strong>Create Folder</strong> — Use the <em>Create Folder</em> button in the
                                    header to group related tests. Folders are local to this machine and stored in the
                                    app layout.</li>
                                <li><strong>Drag &amp; Drop</strong> — Drag test cards (or folder summary lines) and
                                    drop them into folders to move items. You can also drag a folder into another
                                    folder to nest (self/descendant drops are prevented).</li>
                                <li><strong>Expanded State</strong> — Folder summaries support a "show more" state
                                    (the app persists this preference so folders you open remain expanded).</li>
                            </ul>

                            <h4 class="mt-2">Card Actions & Shortcuts</h4>
                            <ul>
                                <li><strong>Start Test</strong> — Click the Start button (or double-click a card) to
                                    begin. You will be prompted for a time limit.</li>
                                <li><strong>Card Menu</strong> — Click the kebab menu on a card for actions: Rename,
                                    Reset stats, Delete and more.</li>
                                <li><strong>Star / Pin</strong> — Click the star to pin important tests near the top.
                                </li>
                                <li><strong>Keyboard</strong> — While taking tests: Arrow keys navigate, 1-4 to answer,
                                    F to flag, P to pause.</li>
                            </ul>

                            <h4 class="mt-2">Statistics & Calendar</h4>
                            <ul>
                                <li><strong>Per-test stats</strong> — Open <em>Test Statistics</em> to see attempts,
                                    averages, best score, average time and last attempt date for each test.</li>
                                <li><strong>Per-set breakdown</strong> — If a test file contains multiple sets,
                                    the stats list can expand to show a row per set (click the caret on the left).
                                    The calendar tooltips also include the set label so you can see which set you
                                    completed on a given day.</li>
                                <li><strong>Calendar</strong> — Switch to the Calendar view to see a compact month
                                    grid of your test activity. Hover any day to see details for that date.</li>
                            </ul>

                            <h4 class="mt-2">Search, Filters & Bulk</h4>
                            <ul>
                                <li><strong>Search</strong> — Use the search bar to filter tests by name or filename.
                                    The Test Statistics view also supports sorting and quick filter options.</li>
                                <li><strong>Bulk Actions (Planned)</strong> — The app already lays the groundwork for
                                    bulk operations (move, delete, export). If you want this, tell us which actions
                                    to prioritize and we’ll implement them next.</li>
                            </ul>

                            <h4 class="mt-2">JSON Formats Accepted</h4>
                            <p>The dashboard loads <code>.json</code> test files from the <code>/json</code> folder or
                                via manual upload. The app accepts a few convenient shapes so you can author tests the
                                way you prefer:</p>
                            <div class="mt-2">
                                <div class="font-medium">1) Simple array of questions (single set)</div>
                                <pre class="bg-gray-100 p-2 rounded text-xs whitespace-pre-wrap"><code>[
  {
    "passage": "Optional passage text...",
    "question": "What is the capital of France?",
    "options": ["A. London", "B. Paris", "C. Berlin"],
    "correctAnswer": "B. Paris"
  }
]</code></pre>

                                <div class="font-medium mt-2">2) Array of sets (multiple sets in one file)</div>
                                <pre class="bg-gray-100 p-2 rounded text-xs whitespace-pre-wrap"><code>[
  [ { /* questions for set A */ }, { /* ... */ } ],
  [ { /* questions for set B */ }, { /* ... */ } ]
]</code></pre>

                                <div class="font-medium mt-2">3) Object with named sets</div>
                                <pre class="bg-gray-100 p-2 rounded text-xs whitespace-pre-wrap"><code>{
  "sets": [
    { "title": "Anatomy A", "questions": [ /* ... */ ] },
    { "title": "Anatomy B", "questions": [ /* ... */ ] }
  ]
}</code></pre>
                                <p class="text-xs text-gray-500 mt-1">When starting a test from a multi-set file you
                                    will be
                                    able to pick which set to run. Attempts record the set index/label so per-set
                                    statistics and calendar tooltips are accurate.</p>
                            </div>

                            <h4 class="mt-2">Tips & Troubleshooting</h4>
                            <ul>
                                <li><strong>Missing stats?</strong> If a file fails to parse it will be listed in the
                                    Load Summary at the top of this modal (populate it by clicking <em>Help</em> in the
                                    header after loading files).</li>
                                <li><strong>No questions shown?</strong> Ensure each question object contains
                                    <code>question</code>, <code>options</code> (array) and <code>correctAnswer</code>.
                                </li>
                                <li><strong>Want improvements?</strong> The app is designed to evolve. Use the
                                    suggestions area in the repo or reply to let me know the dashboard features you
                                    want next (bulk delete, tags, improved search, export/import, etc.).</li>
                            </ul>
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- Test Statistics Modal -->
        <div id="test-stats-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[85vh] flex flex-col">
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between items-center p-4 border-b">
                        <h2 class="text-xl font-semibold text-gray-800">Test Statistics</h2>
                        <button id="close-test-stats-btn" class="text-gray-500 hover:text-gray-700">
                            <i class="ph ph-x text-2xl"></i>
                        </button>
                    </div>
                    <div class="p-4 border-b bg-gray-50">
                        <!-- Tabs moved above controls so calendar view can hide search/sort cleanly -->
                        <div class="tabs" role="tablist" aria-label="Test stats views">
                            <button id="test-stats-tab-list" class="px-3 py-1 rounded-md bg-white text-sm font-medium"
                                role="tab" aria-selected="true">List</button>
                            <button id="test-stats-tab-calendar" class="px-3 py-1 rounded-md text-sm font-medium"
                                role="tab" aria-selected="false">Calendar</button>
                        </div>
                        <div id="test-stats-controls" class="flex items-center gap-3 mt-3 p-2">
                            <div class="relative flex items-center">
                                <!-- Filter toggle on the LEFT of the search input -->
                                <button id="test-stats-filter-toggle" aria-haspopup="true" aria-expanded="false"
                                    title="Filter"
                                    class="mr-2 p-2 bg-white border border-gray-200 rounded-full shadow-sm hover:bg-gray-50">
                                    <i class="ph ph-funnel simple-filter-icon"></i>
                                </button>
                                <input id="test-stats-search" type="search" placeholder="Search tests..."
                                    class="px-3 py-2 border border-gray-300 rounded-md w-96" />
                                <!-- Filter popover positioned relative to this wrapper; top-left aligns with the filter button -->
                                <div id="test-stats-filter-popover"
                                    class="hidden absolute z-40 bg-white border rounded-md shadow-lg p-2 text-sm w-48">
                                    <div class="font-medium mb-2">Sort by</div>
                                    <div class="filter-option p-1 hover:bg-gray-50 cursor-pointer" data-value="name">
                                        Name (A→Z)</div>
                                    <div class="filter-option p-1 hover:bg-gray-50 cursor-pointer"
                                        data-value="attempts">Attempts (desc)</div>
                                    <div class="filter-option p-1 hover:bg-gray-50 cursor-pointer"
                                        data-value="avgPercent">Avg % (desc)</div>
                                    <div class="filter-option p-1 hover:bg-gray-50 cursor-pointer"
                                        data-value="bestPercent">Best % (desc)</div>
                                    <div class="filter-option p-1 hover:bg-gray-50 cursor-pointer" data-value="avgTime">
                                        Avg Time (desc)</div>
                                </div>
                            </div>
                            <!-- Hidden select kept for JS compatibility -->
                            <select id="test-stats-sort" class="hidden" aria-hidden="true">
                                <option value="name">Name (A→Z)</option>
                                <option value="attempts">Attempts (desc)</option>
                                <option value="avgPercent">Avg % (desc)</option>
                                <option value="bestPercent">Best % (desc)</option>
                                <option value="avgTime">Avg Time (desc)</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex items-center gap-3 p-4 border-b bg-gray-50 justify-center">
                        <div id="test-stats-year-controls" class="flex items-center gap-2">
                            <div class="flex items-center gap-2" role="group" aria-label="Calendar year controls">
                                <button id="test-stats-year-prev" class="px-3 py-1 rounded-md text-sm"
                                    aria-label="Previous year">‹</button>
                                <div id="test-stats-year-label" class="px-3 py-1 text-sm font-medium" data-year=""
                                    aria-live="polite">2025</div>
                                <button id="test-stats-year-next" class="px-3 py-1 rounded-md text-sm"
                                    aria-label="Next year">›</button>
                            </div>
                        </div>
                    </div>
                    <div id="test-stats-list" class="p-4 overflow-y-auto text-sm">
                        <!-- Stats table injected here -->
                    </div>
                    <div id="test-stats-calendar" class="p-4 overflow-y-auto text-sm hidden">
                        <!-- Calendar view injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Generic Confirm Modal -->
        <div id="confirm-modal"
            class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center w-full max-w-sm">
                <h2 id="confirm-modal-title" class="text-lg font-semibold mb-2">Please Confirm</h2>
                <p id="confirm-modal-message" class="text-gray-700 mb-6">Are you sure?</p>
                <div class="flex justify-end space-x-2">
                    <button id="confirm-modal-cancel"
                        class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button id="confirm-modal-confirm"
                        class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Application script -->
    <script src="renderer.js" defer></script>


</body>

</html>